import { Plan } from 'pricing4ts';
import { getPricingData } from './services/pricing.service';
import './styles.css';
import { PricingData, PricingProps, RenderingStyles } from './types.d';

import AddOnElement from './components/addon-element';
import PlanHeader from './components/plan-header';
import PricingElement from './components/pricing-element';

export const DEFAULT_RENDERING_STYLES: RenderingStyles = {
  plansColor: '#000000',
  priceColor: '#000000',
  periodColor: '#000000',
  headerColor: '#000000',
  namesColor: '#000000',
  valuesColor: '#000000',
  checkColor: '#000000',
  crossColor: '#000000',
  backgroundColor: '#f3f4f6',
  dividerColor: '#000000',
  billingSelectionColor: '#ffffff',
  billingSelectionBackgroundColor: '#EEE',
  billingSelectionTextColor: '#000000',
  addonBackgroundColor: '#ffffff',
  addonTextColor: '#000000',
};

export function PricingRenderer({ pricing, errors, style }: Readonly<PricingProps>): JSX.Element {
  let pricingData: PricingData = getPricingData(pricing, errors);

  if (!style) {
    style = {};
  }

  // const [selectedBilledType, setSelectedBilledType] =
  //   useState<BilledType>("monthly");
  // function handleSwitchTab(tab: BilledType) {
  //   setSelectedBilledType(tab);
  // }

  return (
    <section
      style={{
        backgroundColor: style.backgroundColor ?? DEFAULT_RENDERING_STYLES.backgroundColor,
      }}>
      <div className='container'>
        {/* Basic Pricing Information */}
        <div className='pricing-info' style={{ marginBottom: '2rem', textAlign: 'center' }}>
          <h2 style={{ color: style.headerColor ?? DEFAULT_RENDERING_STYLES.headerColor }}>
            {pricing?.saasName}
          </h2>
          <div
            style={{ display: 'flex', justifyContent: 'center', gap: '2rem', marginTop: '1rem' }}>
            <div>
              <strong>Plans:</strong> {pricing.plans.length}
            </div>
            <div>
              <strong>Add-ons:</strong> {pricing.addOns?.length || 0}
            </div>
          </div>
        </div>
        {/* <div className="pricing-page-title">
          <h1
            style={{ color: style.headerColor ?? DEFAULT_RENDERING_STYLES.headerColor }}
          >
            {pricing.name.charAt(0).toUpperCase() + pricing.name.slice(1)}{" "}
            Pricing
          </h1>
        </div> */}
        {/* {pricing.hasAnnualPayment && (
          <div className="pricing-page-title">
            <SelectOfferTab
              handleSwitchTab={handleSwitchTab}
              selectedBilledType={selectedBilledType}
              style={style}
            />
          </div>
        )} */}
        <table className='pricing-table'>
          <thead>
            <tr>
              <th></th>
              {pricing.plans.map((plan: Plan, key: number) => (
                <PlanHeader
                  plan={plan}
                  currency={pricing.currency}
                  style={style}
                  key={`${plan.name}-${key}`}
                />
              ))}
            </tr>
          </thead>
          <tbody className='pricing-body'>
            {Object.entries(pricingData).map(
              (
                [name, values]: [string, { value: string | number | boolean; unit?: string }[]],
                key: number
              ) => (
                <PricingElement name={name} values={values} style={style} key={`${name}-${key}`} />
              )
            )}
          </tbody>
        </table>
        {pricing.addOns && (
          <>
            <div
              className='pricing-page-title'
              style={{ color: style.headerColor ?? DEFAULT_RENDERING_STYLES.headerColor }}>
              <h1>Add-Ons</h1>
            </div>
            <div className='add-ons-container'>
              {pricing.addOns.map((addOn, index) => {
                return (
                  <AddOnElement
                    addOn={addOn}
                    currency={pricing.currency}
                    style={style}
                    key={index}
                  />
                );
              })}
            </div>
          </>
        )}
      </div>
    </section>
  );
}
